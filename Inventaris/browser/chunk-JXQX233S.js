import{b as de,d as fe}from"./chunk-LGYB44WQ.js";import{a as pe,b as ue,c as ce}from"./chunk-2KCCNLLX.js";import{a as me}from"./chunk-G32E2IEI.js";import{a as ge}from"./chunk-2NJ5PRWK.js";import{a as K}from"./chunk-LPADCKLS.js";import{a as T,b as V}from"./chunk-UMI7HSWI.js";import{b as A}from"./chunk-GBBGNRVD.js";import{a as le,b as se}from"./chunk-Z33QI66Y.js";import{d as ne,e as oe}from"./chunk-TNBXB3OF.js";import{a as q,b as P,d as G,e as j,i as O,j as R}from"./chunk-NQJA3X5V.js";import{A as ae,B as re,b as $,d,f as H,g as J,l as W,m as z,o as Q,r as X,s as Y,t as Z,u as ee,w as te,y as ie}from"./chunk-CDNC7OL4.js";import{b as B,c as U}from"./chunk-52K55OIP.js";import{h as L}from"./chunk-AUOWE7UJ.js";import{j as D,k as N,x as M}from"./chunk-YBXV6SIX.js";import{Bb as s,Nb as i,Ob as t,Pb as b,Tb as k,Zb as S,db as l,eb as g,gc as w,hc as n,jc as I,na as C,rc as x,ya as h,za as _,zb as u}from"./chunk-PRGEIZ6M.js";import{i as v}from"./chunk-7EPSDV5K.js";function ve(r,m){r&1&&(i(0,"div",27),b(1,"mat-spinner",28),t())}function he(r,m){r&1&&(i(0,"mat-error"),n(1," Nama barang wajib diisi "),t())}function _e(r,m){r&1&&(i(0,"mat-error"),n(1," Jumlah wajib diisi "),t())}function be(r,m){r&1&&(i(0,"mat-error"),n(1," Harga wajib diisi "),t())}function Se(r,m){r&1&&(i(0,"mat-error"),n(1," Spesifikasi wajib diisi "),t())}function Ie(r,m){r&1&&(i(0,"mat-error"),n(1," Tanggal wajib diisi "),t())}function ye(r,m){if(r&1&&(i(0,"option",29),n(1),t()),r&2){let e=m.$implicit;s("value",e.id),l(),I(" ",e.nama_gudang," ")}}function Ee(r,m){if(r&1&&(i(0,"option",29),n(1),t()),r&2){let e=m.$implicit;s("value",e.id),l(),I(" ",e.nama_kategori," ")}}function Fe(r,m){if(r&1&&(i(0,"option",29),n(1),t()),r&2){let e=m.$implicit;s("value",e.id),l(),I(" ",e.nama_divisi," ")}}function Ce(r,m){if(r&1&&(i(0,"option",29),n(1),t()),r&2){let e=m.$implicit;s("value",e.id),l(),I(" ",e.nama_user," ")}}var ze=(()=>{class r{constructor(e,o,a,p,f,c,y,E,F){this.platform=e,this.fb=o,this._apiService=a,this.router=p,this.loadingController=f,this.fuseConfirmationService=c,this._tableUsersService=y,this.dialogRef=E,this.data=F,this.inventarisDatas=[],this.isLoading=!1,this.gudangList=[],this.kategoriList=[],this.divisiList=[],this.userList=[],this.selectedFile=null,this.imageError=null}ngOnInit(){this.inventarisForm=this.fb.group({nama_barang:["",d.required],qty_barang:[null,[d.required,d.min(1)]],harga_pembelian:[null,[d.required,d.min(1)]],spesifikasi:["",d.required],tanggal_pembelian:["",d.required],gudang_id:[null,d.required],kategori_id:[null,d.required],divisi_id:[null,d.required],user_id:[null,d.required],upload_nota:[null,d.required]}),this.platform.backButton.subscribeWithPriority(10,()=>{this.router.navigate(["/dashboard/inventaris"])}),this.getGudangList(),this.getKategoriList(),this.getDivisiList(),this.getUserList()}onNoClick(){this.dialogRef.close()}getRole(){return v(this,null,function*(){let e=yield this._apiService.get("/api/mikrotik/get-profiles");this.inventarisDatas=e.profiles})}onSubmit(){return v(this,null,function*(){if(!this.inventarisForm.valid){console.warn("Form tidak valid");return}this.isLoading=!0;try{let e={nama_barang:this.inventarisForm.value.nama_barang,qty_barang:this.inventarisForm.value.qty_barang,harga_pembelian:this.inventarisForm.value.harga_pembelian,spesifikasi:this.inventarisForm.value.spesifikasi,tanggal_pembelian:this.convertToISOString(this.inventarisForm.value.tanggal_pembelian),gudang_id:Number(this.inventarisForm.value.gudang_id),kategori_id:Number(this.inventarisForm.value.kategori_id),divisi_id:Number(this.inventarisForm.value.divisi_id),user_id:Number(this.inventarisForm.value.user_id)},o=yield this._apiService.post("/inventaris",e);console.log(o);let a=o.inventaris.id;a&&this.selectedFile&&(yield this.uploadImage(a)),this.dialogRef.close("refresh"),this._tableUsersService.fetchData()}catch(e){console.error("Gagal submit form",e)}finally{this.isLoading=!1}})}onFileSelected(e){let o=e.target.files[0];o&&(o.type.startsWith("image/")?(this.selectedFile=o,this.imageError=null,this.inventarisForm.get("upload_nota")?.setValue(o)):(this.selectedFile=null,this.imageError="Hanya file gambar yang diperbolehkan"))}convertToISOString(e){if(e){let o=new Date(e);return A.fromJSDate(new Date(e)).toISODate()}return""}preventInvalidChars(e){let o=e.target.value;e.target.value=o.replace(/[^0-9]/g,"")}getGudangList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/gudang");this.gudangList=e}catch(e){console.error("Gagal ambil data gudang",e)}})}getKategoriList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/kategori");this.kategoriList=e.data}catch(e){console.error("Gagal ambil data kategori",e)}})}getDivisiList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/divisi");this.divisiList=e.data}catch(e){console.error("Gagal ambil data divisi",e)}})}getUserList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/user");this.userList=e}catch(e){console.error("Gagal ambil data user",e)}})}formatCurrency(e){let o=e.target.value;if(o=o.replace(/\D/g,""),o){let a=Number(o);this.inventarisForm.get("harga_pembelian").setValue(a,{emitEvent:!1});let p=a.toLocaleString("id-ID");e.target.value=p}else this.inventarisForm.get("harga_pembelian").setValue(null,{emitEvent:!1})}uploadImage(e){return v(this,null,function*(){if(!this.selectedFile){console.error("No file selected");return}let o=new FormData;o.append("upload_nota",this.selectedFile,this.selectedFile.name);try{let a=yield this._apiService.post(`/upload?id=${e}`,o);console.log("Upload response:",a),a&&a.file&&(this.inventarisForm.get("upload_nota")?.setValue(a.file),this.showSuccessDialog("Gambar berhasil diupload"))}catch(a){console.error("Gagal mengupload gambar:",a),this.imageError="Gagal mengupload gambar"}})}showSuccessDialog(e){this.fuseConfirmationService.open({title:"Berhasil",message:e,icon:{show:!0,name:"heroicons_outline:check-circle",color:"success"},actions:{confirm:{label:"OK",color:"primary"},cancel:{show:!1}},dismissible:!0})}static{this.\u0275fac=function(o){return new(o||r)(g(me),g(ie),g(ge),g(L),g(de),g(K),g(fe),g(T),g(V))}}static{this.\u0275cmp=C({type:r,selectors:[["app-add-inventaris"]],standalone:!0,features:[x],decls:70,vars:13,consts:[["picker",""],[1,"h-full","w-full"],["class","loading-overlay",4,"ngIf"],[1,"w-full",3,"click"],["svgIcon","mat_solid:close",1,"self-end"],[1,"overflow-y-auto",2,"max-height","80vh","padding-right","10px"],[1,"bg-card","mt-2","flex","flex-col","overflow-hidden","rounded-2xl","p-8","pb-4",3,"formGroup"],["floatLabel","always",1,"w-full","mb-2"],["matInput","","formControlName","nama_barang","type","text","placeholder","Masukkan nama barang"],[4,"ngIf"],[1,"w-full","mb-2"],["matInput","","type","number","formControlName","qty_barang","placeholder","Jumlah Barang","min","1",3,"input"],["matInput","","formControlName","harga_pembelian","placeholder","Harga dalam Rupiah",3,"input"],["matPrefix",""],["matInput","","formControlName","spesifikasi","rows","2","placeholder","Deskripsi spesifikasi barang"],["matInput","","formControlName","tanggal_pembelian","placeholder","Pilih tanggal",3,"matDatepicker"],["matSuffix","",3,"for"],["matNativeControl","","formControlName","gudang_id"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["matNativeControl","","formControlName","kategori_id"],["matNativeControl","","formControlName","divisi_id"],["matNativeControl","","formControlName","user_id"],[1,"w-full","mt-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","file",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change"],[1,"bg-green-600","text-white","p-2","rounded","mt-4",3,"click"],[1,"loading-overlay"],["diameter","50","color","primary"],[3,"value"]],template:function(o,a){if(o&1){let p=k();i(0,"div",1),u(1,ve,2,0,"div",2),i(2,"a",3),S("click",function(){return h(p),_(a.onNoClick())}),b(3,"mat-icon",4),t(),i(4,"div",5)(5,"form",6)(6,"mat-form-field",7)(7,"mat-label"),n(8,"Nama Barang"),t(),b(9,"input",8),u(10,he,2,0,"mat-error",9),t(),i(11,"mat-form-field",10)(12,"mat-label"),n(13,"Jumlah Barang"),t(),i(14,"input",11),S("input",function(c){return h(p),_(a.preventInvalidChars(c))}),t(),u(15,_e,2,0,"mat-error",9),t(),i(16,"mat-form-field",10)(17,"mat-label"),n(18,"Harga Pembelian"),t(),i(19,"input",12),S("input",function(c){return h(p),_(a.formatCurrency(c))}),t(),i(20,"span",13),n(21,"Rp\xA0"),t(),u(22,be,2,0,"mat-error",9),t(),i(23,"mat-form-field",10)(24,"mat-label"),n(25,"Spesifikasi"),t(),b(26,"textarea",14),u(27,Se,2,0,"mat-error",9),t(),i(28,"mat-form-field",10)(29,"mat-label"),n(30,"Tanggal Pembelian"),t(),b(31,"input",15)(32,"mat-datepicker-toggle",16)(33,"mat-datepicker",null,0),u(35,Ie,2,0,"mat-error",9),t(),i(36,"mat-form-field",10)(37,"mat-label"),n(38,"Pilih Gudang"),t(),i(39,"select",17)(40,"option",18),n(41,"-- Pilih Gudang --"),t(),u(42,ye,2,2,"option",19),t()(),i(43,"mat-form-field",10)(44,"mat-label"),n(45,"Pilih Kategori"),t(),i(46,"select",20)(47,"option",18),n(48,"-- Pilih Kategori --"),t(),u(49,Ee,2,2,"option",19),t()(),i(50,"mat-form-field",10)(51,"mat-label"),n(52,"Pilih Divisi"),t(),i(53,"select",21)(54,"option",18),n(55,"-- Pilih Divisi --"),t(),u(56,Fe,2,2,"option",19),t()(),i(57,"mat-form-field",10)(58,"mat-label"),n(59,"Pilih User"),t(),i(60,"select",22)(61,"option",18),n(62,"-- Pilih user --"),t(),u(63,Ce,2,2,"option",19),t()(),i(64,"div",23)(65,"label",24),n(66,"Upload Gambar Barang"),t(),i(67,"input",25),S("change",function(c){return h(p),_(a.onFileSelected(c))}),t()(),i(68,"button",26),S("click",function(){return h(p),_(a.onSubmit())}),n(69," Simpan Inventaris "),t()()()()}if(o&2){let p,f,c,y,E,F=w(34);l(),s("ngIf",a.isLoading),l(4),s("formGroup",a.inventarisForm),l(5),s("ngIf",(p=a.inventarisForm.get("nama_barang"))==null?null:p.hasError("required")),l(5),s("ngIf",(f=a.inventarisForm.get("qty_barang"))==null?null:f.hasError("required")),l(7),s("ngIf",(c=a.inventarisForm.get("harga_pembelian"))==null?null:c.hasError("required")),l(5),s("ngIf",(y=a.inventarisForm.get("spesifikasi"))==null?null:y.hasError("required")),l(4),s("matDatepicker",F),l(),s("for",F),l(3),s("ngIf",(E=a.inventarisForm.get("tanggal_pembelian"))==null?null:E.hasError("required")),l(7),s("ngForOf",a.gudangList),l(7),s("ngForOf",a.kategoriList),l(7),s("ngForOf",a.divisiList),l(7),s("ngForOf",a.userList)}},dependencies:[R,O,q,P,G,j,ae,W,Z,ee,$,z,Y,H,J,te,oe,ne,re,Q,X,M,D,N,U,B,ue,ce,pe,se,le],styles:[".loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#ffffffb3;z-index:9999;display:flex;justify-content:center;align-items:center}"]})}}return r})();export{ze as a};
