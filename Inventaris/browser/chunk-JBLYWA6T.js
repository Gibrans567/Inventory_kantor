import{a as se}from"./chunk-R2G5O2T3.js";import{a as le}from"./chunk-RNLVHR5B.js";import{c as oe}from"./chunk-BRBHI7BQ.js";import{a as G}from"./chunk-4ZGOATSA.js";import{a as V,b as L}from"./chunk-K6SJV66T.js";import{b as re}from"./chunk-7I5SQKLH.js";import{e as ne}from"./chunk-BNZ6GVUN.js";import{j as N}from"./chunk-BVYLKFEF.js";import{A as ae,B as ie,b as J,d as w,f as O,g as U,l as K,m as W,o as $,r as z,s as Q,t as Y,u as H,v as X,w as Z,x as ee,y as te}from"./chunk-EMGI2SSV.js";import{b as j,c as P}from"./chunk-IIOR2V55.js";import{k as M,t as D,x as T}from"./chunk-MFIY2XVS.js";import{$b as p,Ac as A,Bb as d,Nb as i,Ob as a,Pb as g,Qb as R,Rb as E,Tb as S,Zb as b,db as l,eb as f,hc as s,ic as y,jc as k,na as F,rc as I,ya as h,za as v,zb as c,zc as q}from"./chunk-ULGM77ZI.js";import{i as B}from"./chunk-7EPSDV5K.js";function ue(n,u){n&1&&(i(0,"div",28),s(1," Status harus dipilih "),a())}function me(n,u){n&1&&(i(0,"div",28),s(1," Jumlah harus diisi "),a())}function ce(n,u){if(n&1&&(i(0,"div",28),s(1),a()),n&2){let e=p(2);l(),k(" Jumlah tidak boleh melebihi stok yang tersedia (",e.sebaranBarang==null?null:e.sebaranBarang.qty_tersedia,"). ")}}function ge(n,u){n&1&&(i(0,"div",28),s(1," Catatan harus diisi "),a())}function pe(n,u){if(n&1){let e=S();R(0),i(1,"div",14)(2,"label",15),s(3,"Jumlah*"),a(),i(4,"input",29),b("input",function(t){h(e);let r=p();return v(r.preventInvalidChars(t))}),a(),c(5,me,2,0,"div",21)(6,ce,2,1,"div",21),a(),i(7,"div",14)(8,"label",15),s(9,"Catatan*"),a(),g(10,"textarea",30),c(11,ge,2,0,"div",21),a(),E()}if(n&2){let e,o,t,r=p();l(4),d("max",r.sebaranBarang==null?null:r.sebaranBarang.qty_tersedia),l(),d("ngIf",((e=r.BarangRusakForm.get("qty_barang"))==null?null:e.hasError("required"))&&((e=r.BarangRusakForm.get("qty_barang"))==null?null:e.touched)),l(),d("ngIf",((o=r.BarangRusakForm.get("qty_barang"))==null?null:o.hasError("max"))&&((o=r.BarangRusakForm.get("qty_barang"))==null?null:o.touched)),l(5),d("ngIf",((t=r.BarangRusakForm.get("catatan"))==null?null:t.hasError("required"))&&((t=r.BarangRusakForm.get("catatan"))==null?null:t.touched))}}function fe(n,u){n&1&&(i(0,"div",28),s(1," Jumlah harus diisi "),a())}function _e(n,u){if(n&1&&(i(0,"div",28),s(1),a()),n&2){let e=p(2);l(),k(" Jumlah tidak boleh melebihi stok yang tersedia (",e.sebaranBarang==null?null:e.sebaranBarang.qty_tersedia,"). ")}}function he(n,u){n&1&&(i(0,"div",28),s(1," Posisi akhir harus diisi "),a())}function ve(n,u){if(n&1){let e=S();R(0),i(1,"div",14)(2,"label",15),s(3,"Jumlah*"),a(),i(4,"input",29),b("input",function(t){h(e);let r=p();return v(r.preventInvalidChars(t))}),a(),c(5,fe,2,0,"div",21)(6,_e,2,1,"div",21),a(),i(7,"div",14)(8,"label",15),s(9,"Posisi Akhir*"),a(),g(10,"input",31),c(11,he,2,0,"div",21),a(),E()}if(n&2){let e,o,t,r=p();l(4),d("max",r.sebaranBarang==null?null:r.sebaranBarang.qty_tersedia),l(),d("ngIf",((e=r.BarangRusakForm.get("qty_barang"))==null?null:e.hasError("required"))&&((e=r.BarangRusakForm.get("qty_barang"))==null?null:e.touched)),l(),d("ngIf",((o=r.BarangRusakForm.get("qty_barang"))==null?null:o.hasError("max"))&&((o=r.BarangRusakForm.get("qty_barang"))==null?null:o.touched)),l(5),d("ngIf",((t=r.BarangRusakForm.get("posisi_akhir"))==null?null:t.hasError("required"))&&((t=r.BarangRusakForm.get("posisi_akhir"))==null?null:t.touched))}}function be(n,u){if(n&1&&(i(0,"div",32),s(1),g(2,"br"),s(3),g(4,"br"),s(5),q(6,"json"),a()),n&2){let e=p();l(),k(" Form Valid: ",e.BarangRusakForm.valid," "),l(2),k(" Form Status: ",e.BarangRusakForm.status," "),l(2),k(" Form Value: ",A(6,3,e.BarangRusakForm.value)," ")}}function ke(n,u){n&1&&(i(0,"span"),s(1,"Simpan"),a())}function xe(n,u){n&1&&(i(0,"div",33),g(1,"div",34),a())}var Ne=(()=>{class n{constructor(e,o,t,r,m,_){this.fb=e,this._apiService=o,this.platform=t,this._fuseConfirmationService=r,this.dialogRef=m,this.data=_,this.isLoading=!1,this.divisiList=[],this.userList=[]}ngOnInit(){console.log("Data received:",this.data),this.sebaranBarang=this.data,this.BarangRusakForm=this.fb.group({qty_barang:[null,[w.required,w.min(1),w.max(this.sebaranBarang?.qty_barang)]],posisi_awal:[this.sebaranBarang?.posisi_awal||""],posisi_akhir:[null],catatan:[null]}),this.getDivisiList(),this.getUserList()}onNoClick(){this.dialogRef.close()}getDivisiList(){return B(this,null,function*(){try{let e=yield this._apiService.get("/divisi",!0);this.divisiList=e.data||[]}catch(e){console.error("Failed to fetch divisi data",e),this.showErrorDialog("Gagal mengambil data divisi")}})}getUserList(){return B(this,null,function*(){try{let e=yield this._apiService.get("/user",!0);console.log("API response:",e),Array.isArray(e)?this.userList=e:e.data&&Array.isArray(e.data)?this.userList=e.data:(console.error("Unexpected API response format:",e),this.userList=[]),console.log("Processed userList:",this.userList)}catch(e){console.error("Gagal ambil data user",e),this.userList=[]}})}onSubmit(){return B(this,null,function*(){if(!this.BarangRusakForm.valid){this.showWarningDialog("Mohon isi semua field yang wajib diisi");return}let e=this.BarangRusakForm.value.posisi_awal,o=this.BarangRusakForm.value.qty_barang,t=this.sebaranBarang?.qty_tersedia;if(o>t){this.showWarningDialog(`Jumlah barang tidak boleh melebihi stok tersedia (${t})`);return}let r=Number(this.BarangRusakForm.value.user_id);this._fuseConfirmationService.open({title:"Tambah Sebaran Barang",message:`Anda yakin ingin menambahkan ${o} ${this.sebaranBarang.nama_barang} ke distribusi?`,icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Ya, Tambahkan",color:"primary"},cancel:{label:"Batal"}}}).afterClosed().subscribe(_=>B(this,null,function*(){if(_==="confirmed"){this.isLoading=!0;try{if(e==="Maintenance"||e==="Barang rusak"){let x=this.BarangRusakForm.value.catatan,C={id_barang:this.sebaranBarang.id_barang,id_sebaran_barang:this.sebaranBarang.id,status:e,note:x,qty_barang:o,posisi_akhir:this.sebaranBarang.posisi_akhir},de=yield this._apiService.post("/barangStatus",C);console.log("Response Status Update:",de),this.showSuccessDialog("Status barang berhasil diperbarui!"),this.dialogRef.close("refresh")}else if(e==="memindahkan"){let x={id_sebaran:this.sebaranBarang.id,qty_barang:o,posisi_akhir:this.BarangRusakForm.value.posisi_akhir,status:"Dipindahkan"},C=yield this._apiService.post("/sebaranBarang/pindah",x);console.log("Response Memindahkan:",C),this.showSuccessDialog("Barang berhasil dipindahkan!"),this.dialogRef.close("refresh")}}catch(x){console.error("Error:",x),this.showErrorDialog("Gagal memproses permintaan")}finally{this.isLoading=!1}}}))})}preventInvalidChars(e){let o=e.target.value,t=this.sebaranBarang?.qty_tersedia;o>t&&(e.target.value=t),e.target.value=o.replace(/[^0-9]/g,"")}getDivisiDisplayFn(){return e=>{let o=this.divisiList.find(t=>t.id===e);return o?o.nama_divisi:""}}getUserDisplayFn(){return e=>{let o=this.userList.find(t=>t.id===e);return o?o.nama:""}}showSuccessDialog(e){this._fuseConfirmationService.open({title:"Berhasil",message:e,icon:{show:!0,name:"heroicons_outline:check-circle",color:"success"},actions:{confirm:{label:"OK",color:"primary"},cancel:{show:!1}},dismissible:!0})}showWarningDialog(e){this._fuseConfirmationService.open({title:"Peringatan",message:e,icon:{show:!0,name:"heroicons_outline:exclamation",color:"warning"},actions:{confirm:{label:"OK",color:"warn"},cancel:{show:!1}},dismissible:!0})}showErrorDialog(e){this._fuseConfirmationService.open({title:"Error",message:e,icon:{show:!0,name:"heroicons_outline:x-circle",color:"error"},actions:{confirm:{label:"OK",color:"warn"},cancel:{show:!1}},dismissible:!0})}static{this.\u0275fac=function(o){return new(o||n)(f(te),f(le),f(se),f(G),f(V),f(L))}}static{this.\u0275cmp=F({type:n,selectors:[["app-add-barang-rusak"]],standalone:!0,features:[I],decls:55,vars:13,consts:[["formDirective","ngForm"],[1,"flex","flex-col","p-6","w-full","max-h-screen","overflow-auto"],[1,"flex","flex-0","items-center","justify-between","w-full","sticky","top-0","bg-white","z-10","pb-2"],[1,"text-2xl","font-extrabold","tracking-tight"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"my-4","border-b","w-full"],[1,"mt-2","overflow-y-auto","flex-1","w-full"],[1,"bg-gray-100","p-4","mb-6","rounded-lg","w-full"],[1,"grid","grid-cols-2","gap-4"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-base","font-bold"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"flex","flex-col","space-y-4"],[1,"w-full"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["formControlName","posisi_awal","required","",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","appearance-none","bg-white"],["value","","disabled","","selected",""],["value","Maintenance"],["value","Barang rusak"],["value","memindahkan"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[4,"ngIf"],["class","text-xs text-gray-500 mt-4",4,"ngIf"],[1,"flex","items-center","justify-center","mt-8","gap-4","pt-4","pb-2","w-full"],["type","button",1,"px-4","py-2","rounded","border","border-gray-300",3,"click"],["type","submit",1,"bg-green-600","text-white","px-4","py-2","rounded",3,"disabled"],["class","flex items-center justify-center",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],["type","number","formControlName","qty_barang","required","","min","1",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","max"],["formControlName","catatan","placeholder","Masukkan catatan","required","",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["formControlName","posisi_akhir","placeholder","Posisi akhir barang","required","",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"text-xs","text-gray-500","mt-4"],[1,"flex","items-center","justify-center"],[1,"animate-spin","rounded-full","h-5","w-5","border-t-2","border-white","border-r-2"]],template:function(o,t){if(o&1){let r=S();i(0,"div",1)(1,"div",2)(2,"div",3),s(3,"Edit Barang"),a(),i(4,"button",4),b("click",function(){return h(r),v(t.onNoClick())}),g(5,"mat-icon",5),a()(),g(6,"div",6),i(7,"div",7)(8,"div",8)(9,"div",9)(10,"div")(11,"div",10),s(12,"Nama Barang"),a(),i(13,"div",11),s(14),a()(),i(15,"div")(16,"div",10),s(17,"Nama Divisi"),a(),i(18,"div",11),s(19),a()(),i(20,"div")(21,"div",10),s(22,"Stok Tersedia"),a(),i(23,"div",11),s(24),a()(),i(25,"div")(26,"div",10),s(27,"Penempatan"),a(),i(28,"div",11),s(29),a()()()(),i(30,"form",12,0),b("ngSubmit",function(){return h(r),v(t.onSubmit())}),i(32,"div",13)(33,"div",14)(34,"label",15),s(35,"Status"),a(),i(36,"select",16)(37,"option",17),s(38,"Pilih Status"),a(),i(39,"option",18),s(40,"Maintenance"),a(),i(41,"option",19),s(42,"Barang Rusak"),a(),i(43,"option",20),s(44,"Dipindahkan"),a()(),c(45,ue,2,0,"div",21),a(),c(46,pe,12,4,"ng-container",22)(47,ve,12,4,"ng-container",22),a(),c(48,be,7,5,"div",23),i(49,"div",24)(50,"button",25),b("click",function(){return h(r),v(t.onNoClick())}),s(51," Batal "),a(),i(52,"button",26),c(53,ke,2,0,"span",22)(54,xe,2,0,"div",27),a()()()()()}if(o&2){let r,m,_;l(5),d("svgIcon","heroicons_outline:x-mark"),l(9),y((t.sebaranBarang==null?null:t.sebaranBarang.barang)||"Tidak ada data"),l(5),y((t.sebaranBarang==null?null:t.sebaranBarang.divisi)||"Tidak ada data"),l(5),y((t.sebaranBarang==null?null:t.sebaranBarang.qty_barang)||0),l(5),y((t.sebaranBarang==null?null:t.sebaranBarang.posisi_akhir)||"Tidak ada data"),l(),d("formGroup",t.BarangRusakForm),l(15),d("ngIf",((r=t.BarangRusakForm.get("posisi_awal"))==null?null:r.hasError("required"))&&((r=t.BarangRusakForm.get("posisi_awal"))==null?null:r.touched)),l(),d("ngIf",((m=t.BarangRusakForm.get("posisi_awal"))==null?null:m.value)==="Maintenance"||((m=t.BarangRusakForm.get("posisi_awal"))==null?null:m.value)==="Barang rusak"),l(),d("ngIf",((_=t.BarangRusakForm.get("posisi_awal"))==null?null:_.value)==="memindahkan"),l(),d("ngIf",!1),l(4),d("disabled",t.BarangRusakForm.invalid||t.isLoading),l(),d("ngIf",!t.isLoading),l(),d("ngIf",t.isLoading)}},dependencies:[T,M,D,ae,K,Y,H,J,W,Q,O,U,ee,Z,X,ie,$,z,N,ne,P,j,oe,re]})}}return n})();export{Ne as a};
