import{a as ue,b as ce,c as ge}from"./chunk-SMPCWE35.js";import{b as pe,d as fe}from"./chunk-PTF54ZHH.js";import{a as de}from"./chunk-R2G5O2T3.js";import{a as K}from"./chunk-4ZGOATSA.js";import{a as V,b as T}from"./chunk-K6SJV66T.js";import{b as A}from"./chunk-GBBGNRVD.js";import{a as se,b as me}from"./chunk-7I5SQKLH.js";import{d as oe,e as le}from"./chunk-BNZ6GVUN.js";import{a as q,b as G,d as P,e as j,i as O,j as R}from"./chunk-BVYLKFEF.js";import{A as re,B as ne,b as J,d,f as $,g as W,l as z,m as Q,o as X,r as Y,s as Z,t as ee,u as te,w as ie,y as ae}from"./chunk-EMGI2SSV.js";import{b as B,c as U}from"./chunk-IIOR2V55.js";import{f as H}from"./chunk-SQERYEB6.js";import{h as L}from"./chunk-HZDJ65MY.js";import{j as D,k as N,x as M}from"./chunk-MFIY2XVS.js";import{Bb as s,Nb as a,Ob as t,Pb as b,Tb as k,Zb as S,db as l,eb as c,gc as w,hc as o,jc as C,na as E,rc as x,ya as h,za as _,zb as g}from"./chunk-ULGM77ZI.js";import{i as v}from"./chunk-7EPSDV5K.js";function ve(r,p){r&1&&(a(0,"div",26),b(1,"mat-spinner",27),t())}function he(r,p){r&1&&(a(0,"mat-error"),o(1," Nama barang wajib diisi "),t())}function _e(r,p){r&1&&(a(0,"mat-error"),o(1," Jumlah wajib diisi "),t())}function be(r,p){r&1&&(a(0,"mat-error"),o(1," Harga wajib diisi "),t())}function Se(r,p){r&1&&(a(0,"mat-error"),o(1," Spesifikasi wajib diisi "),t())}function Ie(r,p){r&1&&(a(0,"mat-error"),o(1," Tanggal wajib diisi "),t())}function ye(r,p){if(r&1&&(a(0,"option",28),o(1),t()),r&2){let e=p.$implicit;s("value",e.id),l(),C(" ",e.nama_gudang," ")}}function Fe(r,p){if(r&1&&(a(0,"option",28),o(1),t()),r&2){let e=p.$implicit;s("value",e.id),l(),C(" ",e.nama_kategori," ")}}function Ce(r,p){if(r&1&&(a(0,"option",28),o(1),t()),r&2){let e=p.$implicit;s("value",e.id),l(),C(" ",e.nama_user," ")}}var We=(()=>{class r{constructor(e,n,i,m,f,u,I,y,F){this.platform=e,this.fb=n,this._apiService=i,this.router=m,this.loadingController=f,this.fuseConfirmationService=u,this._tableUsersService=I,this.dialogRef=y,this.data=F,this.inventarisDatas=[],this.isLoading=!1,this.gudangList=[],this.kategoriList=[],this.divisiList=[],this.userList=[],this.selectedFile=null,this.imageError=null}ngOnInit(){this.inventarisForm=this.fb.group({nama_barang:["",d.required],qty_barang:[null,[d.required,d.min(1)]],harga_pembelian:[null,[d.required,d.min(1)]],spesifikasi:["",d.required],tanggal_pembelian:["",d.required],gudang_id:[null,d.required],kategori_id:[null,d.required],user_id:[null,d.required],upload_nota:[null,d.required]}),this.platform.backButton.subscribeWithPriority(10,()=>{this.router.navigate(["/dashboard/inventaris"])}),this.getGudangList(),this.getKategoriList(),this.getDivisiList(),this.getUserList()}onNoClick(){this.dialogRef.close()}getRole(){return v(this,null,function*(){let e=yield this._apiService.get("/api/mikrotik/get-profiles",!0);this.inventarisDatas=e.profiles})}onSubmit(){return v(this,null,function*(){if(!this.inventarisForm.valid){console.warn("Form tidak valid");return}this.isLoading=!0;try{let e={nama_barang:this.inventarisForm.value.nama_barang,qty_barang:this.inventarisForm.value.qty_barang,harga_pembelian:this.inventarisForm.value.harga_pembelian,spesifikasi:this.inventarisForm.value.spesifikasi,tanggal_pembelian:this.convertToISOString(this.inventarisForm.value.tanggal_pembelian),gudang_id:Number(this.inventarisForm.value.gudang_id),kategori_id:Number(this.inventarisForm.value.kategori_id),divisi_id:Number(this.inventarisForm.value.divisi_id),user_id:Number(this.inventarisForm.value.user_id)},n=yield this._apiService.post("/inventaris",e);console.log(n);let i=n.inventaris.id;i&&this.selectedFile&&(yield this.uploadImage(i)),this.dialogRef.close("refresh"),this._tableUsersService.fetchData()}catch(e){console.error("Gagal submit form",e)}finally{this.isLoading=!1}})}onFileSelected(e){let n=e.target.files[0];n&&(n.type.startsWith("image/")?(this.selectedFile=n,this.imageError=null,this.inventarisForm.get("upload_nota")?.setValue(n)):(this.selectedFile=null,this.imageError="Hanya file gambar yang diperbolehkan"))}convertToISOString(e){if(e){let n=new Date(e);return A.fromJSDate(new Date(e)).toISODate()}return""}preventInvalidChars(e){let n=e.target.value;e.target.value=n.replace(/[^0-9]/g,"")}getGudangList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/gudang",!0);this.gudangList=e}catch(e){console.error("Gagal ambil data gudang",e)}})}getKategoriList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/kategori",!0);this.kategoriList=e.data}catch(e){console.error("Gagal ambil data kategori",e)}})}getDivisiList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/divisi",!0);this.divisiList=e.data}catch(e){console.error("Gagal ambil data divisi",e)}})}getUserList(){return v(this,null,function*(){try{let e=yield this._apiService.get("/user",!0);this.userList=e}catch(e){console.error("Gagal ambil data user",e)}})}formatCurrency(e){let n=e.target.value;if(n=n.replace(/\D/g,""),n){let i=Number(n);this.inventarisForm.get("harga_pembelian").setValue(i,{emitEvent:!1});let m=i.toLocaleString("id-ID");e.target.value=m}else this.inventarisForm.get("harga_pembelian").setValue(null,{emitEvent:!1})}uploadImage(e){return v(this,null,function*(){if(!this.selectedFile){console.error("No file selected");return}let n=new FormData;n.append("upload_nota",this.selectedFile,this.selectedFile.name);try{let i=yield this._apiService.post(`/upload?id=${e}`,n);console.log("Upload response:",i),i&&i.file&&(this.inventarisForm.get("upload_nota")?.setValue(i.file),this.showSuccessDialog("Gambar berhasil diupload"))}catch(i){console.error("Gagal mengupload gambar:",i),this.imageError="Gagal mengupload gambar"}})}showSuccessDialog(e){this.fuseConfirmationService.open({title:"Berhasil",message:e,icon:{show:!0,name:"heroicons_outline:check-circle",color:"success"},actions:{confirm:{label:"OK",color:"primary"},cancel:{show:!1}},dismissible:!0})}static{this.\u0275fac=function(n){return new(n||r)(c(de),c(ae),c(H),c(L),c(pe),c(K),c(fe),c(V),c(T))}}static{this.\u0275cmp=E({type:r,selectors:[["app-add-inventaris"]],standalone:!0,features:[x],decls:63,vars:12,consts:[["picker",""],[1,"h-full","w-full"],["class","loading-overlay",4,"ngIf"],[1,"w-full",3,"click"],["svgIcon","mat_solid:close",1,"self-end"],[1,"overflow-y-auto",2,"max-height","80vh","padding-right","10px"],[1,"bg-card","mt-2","flex","flex-col","overflow-hidden","rounded-2xl","p-8","pb-4",3,"formGroup"],["floatLabel","always",1,"w-full","mb-2"],["matInput","","formControlName","nama_barang","type","text","placeholder","Masukkan nama barang"],[4,"ngIf"],[1,"w-full","mb-2"],["matInput","","type","number","formControlName","qty_barang","placeholder","Jumlah Barang","min","1",3,"input"],["matInput","","formControlName","harga_pembelian","placeholder","Harga dalam Rupiah",3,"input"],["matPrefix",""],["matInput","","formControlName","spesifikasi","rows","2","placeholder","Deskripsi spesifikasi barang"],["matInput","","formControlName","tanggal_pembelian","placeholder","Pilih tanggal",3,"matDatepicker"],["matSuffix","",3,"for"],["matNativeControl","","formControlName","gudang_id"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["matNativeControl","","formControlName","kategori_id"],["matNativeControl","","formControlName","user_id"],[1,"w-full","mt-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","file",1,"w-full","p-3","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change"],[1,"bg-green-600","text-white","p-2","rounded","mt-4",3,"click"],[1,"loading-overlay"],["diameter","50","color","primary"],[3,"value"]],template:function(n,i){if(n&1){let m=k();a(0,"div",1),g(1,ve,2,0,"div",2),a(2,"a",3),S("click",function(){return h(m),_(i.onNoClick())}),b(3,"mat-icon",4),t(),a(4,"div",5)(5,"form",6)(6,"mat-form-field",7)(7,"mat-label"),o(8,"Nama Barang"),t(),b(9,"input",8),g(10,he,2,0,"mat-error",9),t(),a(11,"mat-form-field",10)(12,"mat-label"),o(13,"Jumlah Barang"),t(),a(14,"input",11),S("input",function(u){return h(m),_(i.preventInvalidChars(u))}),t(),g(15,_e,2,0,"mat-error",9),t(),a(16,"mat-form-field",10)(17,"mat-label"),o(18,"Harga Pembelian"),t(),a(19,"input",12),S("input",function(u){return h(m),_(i.formatCurrency(u))}),t(),a(20,"span",13),o(21,"Rp\xA0"),t(),g(22,be,2,0,"mat-error",9),t(),a(23,"mat-form-field",10)(24,"mat-label"),o(25,"Spesifikasi"),t(),b(26,"textarea",14),g(27,Se,2,0,"mat-error",9),t(),a(28,"mat-form-field",10)(29,"mat-label"),o(30,"Tanggal Pembelian"),t(),b(31,"input",15)(32,"mat-datepicker-toggle",16)(33,"mat-datepicker",null,0),g(35,Ie,2,0,"mat-error",9),t(),a(36,"mat-form-field",10)(37,"mat-label"),o(38,"Pilih Gudang"),t(),a(39,"select",17)(40,"option",18),o(41,"-- Pilih Gudang --"),t(),g(42,ye,2,2,"option",19),t()(),a(43,"mat-form-field",10)(44,"mat-label"),o(45,"Pilih Kategori"),t(),a(46,"select",20)(47,"option",18),o(48,"-- Pilih Kategori --"),t(),g(49,Fe,2,2,"option",19),t()(),a(50,"mat-form-field",10)(51,"mat-label"),o(52,"Pilih User"),t(),a(53,"select",21)(54,"option",18),o(55,"-- Pilih user --"),t(),g(56,Ce,2,2,"option",19),t()(),a(57,"div",22)(58,"label",23),o(59,"Upload Gambar Barang"),t(),a(60,"input",24),S("change",function(u){return h(m),_(i.onFileSelected(u))}),t()(),a(61,"button",25),S("click",function(){return h(m),_(i.onSubmit())}),o(62," Simpan Inventaris "),t()()()()}if(n&2){let m,f,u,I,y,F=w(34);l(),s("ngIf",i.isLoading),l(4),s("formGroup",i.inventarisForm),l(5),s("ngIf",(m=i.inventarisForm.get("nama_barang"))==null?null:m.hasError("required")),l(5),s("ngIf",(f=i.inventarisForm.get("qty_barang"))==null?null:f.hasError("required")),l(7),s("ngIf",(u=i.inventarisForm.get("harga_pembelian"))==null?null:u.hasError("required")),l(5),s("ngIf",(I=i.inventarisForm.get("spesifikasi"))==null?null:I.hasError("required")),l(4),s("matDatepicker",F),l(),s("for",F),l(3),s("ngIf",(y=i.inventarisForm.get("tanggal_pembelian"))==null?null:y.hasError("required")),l(7),s("ngForOf",i.gudangList),l(7),s("ngForOf",i.kategoriList),l(7),s("ngForOf",i.userList)}},dependencies:[R,O,q,G,P,j,re,z,ee,te,J,Q,Z,$,W,ie,le,oe,ne,X,Y,M,D,N,U,B,ce,ge,ue,me,se],styles:[".loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#ffffffb3;z-index:9999;display:flex;justify-content:center;align-items:center}"]})}}return r})();export{We as a};
